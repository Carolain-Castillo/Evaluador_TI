<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Evaluador Técnico de Equipos TI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
        .card { background: white; border-radius: 12px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); }
        select { cursor: pointer; }
        .status-pill { padding: 4px 12px; border-radius: 9999px; font-weight: 600; font-size: 0.875rem; }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-5xl mx-auto">
        <!-- Header -->
        <div class="mb-8 text-center md:text-left flex flex-col md:flex-row justify-between items-end">
            <div>
                <h1 class="text-3xl font-bold text-gray-800">Evaluación Técnica TI</h1>
                <p class="text-gray-500">Sistema de evaluación objetiva e iterativa por perfil de usuario</p>
            </div>
            <div class="mt-4 md:mt-0">
                <label class="block text-sm font-semibold text-gray-700 mb-1">Perfil del Usuario Final</label>
                <select id="perfilUsuario" onchange="calculateScore()" class="w-64 p-2 border-2 border-blue-500 rounded-lg bg-blue-50 text-blue-800 font-bold focus:outline-none">
                    <option value="ADMIN">Administrativo / Ejecutivo</option>
                    <option value="CAD_BIM">CAD / BIM</option>
                </select>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <!-- Main Table Section -->
            <div class="lg:col-span-2 space-y-6">
                <div class="card overflow-hidden">
                    <table class="w-full text-left border-collapse">
                        <thead class="bg-gray-800 text-white">
                            <tr>
                                <th class="p-4 text-sm font-semibold uppercase">Criterio</th>
                                <th class="p-4 text-sm font-semibold uppercase">Condición / Estado</th>
                                <th class="p-4 text-sm font-semibold uppercase text-center">Pts</th>
                            </tr>
                        </thead>
                        <tbody id="tablaEvaluacion" class="divide-y divide-gray-200 text-gray-700">
                            <!-- Antigüedad -->
                            <tr>
                                <td class="p-4 font-medium">Antigüedad</td>
                                <td class="p-4">
                                    <select data-key="antiguedad" onchange="calculateScore()" class="w-full p-1 border rounded">
                                        <option value="10">0 – 2 años</option>
                                        <option value="6">3 – 4 años</option>
                                        <option value="3">5 – 6 años</option>
                                        <option value="1">7 – 8 años</option>
                                        <option value="1">9 – 10 años</option>
                                    </select>
                                </td>
                                <td class="p-4 text-center font-bold text-blue-600 score-val">-</td>
                            </tr>
                            <!-- Estado Físico Group -->
                            <tr class="bg-gray-50"><td colspan="3" class="px-4 py-2 text-center text-lg font-extrabold text-gray-700">ESTADO FÍSICO</td></tr>
                            <tr>
                                <td class="p-4 font-medium italic pl-8">Carcasa</td>
                                <td class="p-4">
                                    <select data-key="carcasa" onchange="calculateScore()" class="w-full p-1 border rounded">
                                        <option value="10">Buen estado físico</option>
                                        <option value="6">Detalles menores</option>
                                        <option value="1">Dañado / Trizado</option>
                                    </select>
                                </td>
                                <td class="p-4 text-center font-bold text-blue-600 score-val">-</td>
                            </tr>
                            <tr>
                                <td class="p-4 font-medium italic pl-8">Teclado</td>
                                <td class="p-4">
                                    <select data-key="teclado" onchange="calculateScore()" class="w-full p-1 border rounded">
                                        <option value="10">Buen estado físico</option>
                                        <option value="6">Detalles menores</option>
                                        <option value="1">Dañado / Trizado</option>
                                    </select>
                                </td>
                                <td class="p-4 text-center font-bold text-blue-600 score-val">-</td>
                            </tr>
                            <tr>
                                <td class="p-4 font-medium italic pl-8">Pantalla</td>
                                <td class="p-4">
                                    <select data-key="pantalla" onchange="calculateScore()" class="w-full p-1 border rounded">
                                        <option value="10">Buen estado físico</option>
                                        <option value="6">Detalles menores</option>
                                        <option value="1">Dañado / Trizado</option>
                                    </select>
                                </td>
                                <td class="p-4 text-center font-bold text-blue-600 score-val">-</td>
                            </tr>
                            <!-- Puertos y Funcionalidad (integrado bajo ESTADO FÍSICO) -->
                            <tr>
                                <td class="p-4 font-medium">Estado Batería</td>
                                <td class="p-4">
                                    <select data-key="bateria" onchange="calculateScore()" class="w-full p-1 border rounded">
                                        <option value="10">90% - 100%</option>
                                        <option value="6">80% - 89%</option>
                                        <option value="3">70% - 79%</option>
                                        <option value="1">60% - 69%</option>
                                        <option value="0">&lt; 60%</option>
                                    </select>
                                </td>
                                <td class="p-4 text-center font-bold text-blue-600 score-val">-</td>
                            </tr>
                            <tr>
                                <td class="p-4 font-medium">Puertos USB</td>
                                <td class="p-4">
                                    <select data-key="usb" onchange="calculateScore()" class="w-full p-1 border rounded">
                                        <option value="10">Todos operativos</option>
                                        <option value="1">Algunos con fallas</option>
                                    </select>
                                </td>
                                <td class="p-4 text-center font-bold text-blue-600 score-val">-</td>
                            </tr>
                            <tr>
                                <td class="p-4 font-medium">Puerto Carga</td>
                                <td class="p-4">
                                    <select data-key="carga" onchange="calculateScore()" class="w-full p-1 border rounded">
                                        <option value="10">Bueno</option>
                                        <option value="6">Delicado</option>
                                        <option value="1">Malo</option>
                                    </select>
                                </td>
                                <td class="p-4 text-center font-bold text-blue-600 score-val">-</td>
                            </tr>
                            <tr>
                                <td class="p-4 font-medium">Estado Puerto HDMI</td>
                                <td class="p-4">
                                    <select data-key="hdmi" onchange="calculateScore()" class="w-full p-1 border rounded">
                                        <option value="10">Funciona</option>
                                        <option value="1">No funciona</option>
                                    </select>
                                </td>
                                <td class="p-4 text-center font-bold text-blue-600 score-val">-</td>
                            </tr>
                            <tr>
                                <td class="p-4 font-medium">Estado Puerto Red</td>
                                <td class="p-4">
                                    <select data-key="red" onchange="calculateScore()" class="w-full p-1 border rounded">
                                        <option value="10">Funciona</option>
                                        <option value="1">No funciona</option>
                                    </select>
                                </td>
                                <td class="p-4 text-center font-bold text-blue-600 score-val">-</td>
                            </tr>
                            <tr>
                                <td class="p-4 font-medium">Estado del audio</td>
                                <td class="p-4">
                                    <select data-key="audio" onchange="calculateScore()" class="w-full p-1 border rounded">
                                        <option value="10">Funciona</option>
                                        <option value="1">No funciona</option>
                                    </select>
                                </td>
                                <td class="p-4 text-center font-bold text-blue-600 score-val">-</td>
                            </tr>
                            <tr>
                                <td class="p-4 font-medium">Estado de la cámara</td>
                                <td class="p-4">
                                    <select data-key="camara" onchange="calculateScore()" class="w-full p-1 border rounded">
                                        <option value="10">Funciona</option>
                                        <option value="1">No funciona</option>
                                    </select>
                                </td>
                                <td class="p-4 text-center font-bold text-blue-600 score-val">-</td>
                            </tr>
                            <!-- Hardware Crítico -->
                            <tr class="bg-gray-50"><td colspan="3" class="px-4 py-2 text-center text-lg font-extrabold text-gray-700">RENDIMIENTO INTERNO</td></tr>
                            <tr>
                                <td class="p-4 font-medium">¿Enciende?</td>
                                <td class="p-4">
                                    <select data-key="enciende" onchange="calculateScore()" class="w-full p-1 border rounded">
                                        <option value="10">Enciende sin problemas</option>
                                        <option value="0">No enciende</option>
                                    </select>
                                </td>
                                <td class="p-4 text-center font-bold text-blue-600 score-val">-</td>
                            </tr>
                            <tr>
                                <td class="p-4 font-medium">Memoria RAM</td>
                                <td class="p-4">
                                    <select id="ramSelect" data-key="ram" onchange="calculateScore()" class="w-full p-1 border rounded">
                                        <option value="10">≥ 32 GB</option>
                                        <option value="6">16 GB</option>
                                        <option value="3">8 GB</option>
                                        <option value="1">4 GB</option>
                                        <option value="0">Sin RAM</option>
                                    </select>
                                </td>
                                <td class="p-4 text-center font-bold text-blue-600 score-val">-</td>
                            </tr>
                            <tr>
                                <td class="p-4 font-medium">Disco Duro</td>
                                <td class="p-4">
                                    <select id="discoSelect" data-key="disco" onchange="calculateScore()" class="w-full p-1 border rounded">
                                        <option value="10">SSD > 500 GB</option>
                                        <option value="6">SSD ≤ 500 GB</option>
                                        <option value="1">HDD Mecánico</option>
                                    </select>
                                </td>
                                <td class="p-4 text-center font-bold text-blue-600 score-val">-</td>
                            </tr>
                            <tr>
                                <td class="p-4 font-medium">Tarjeta de Video</td>
                                <td class="p-4">
                                    <select id="gpuSelect" data-key="video" onchange="calculateScore()" class="w-full p-1 border rounded">
                                        <option value="10">Dedicada ≥ 8 GB</option>
                                        <option value="6">Dedicada 4 GB</option>
                                        <option value="3">Dedicada 2 GB</option>
                                        <option value="0">No tiene</option>
                                    </select>
                                </td>
                                <td class="p-4 text-center font-bold text-blue-600 score-val">-</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Dashboard / Results Section -->
            <div class="space-y-6">
                <!-- Puntaje Ponderado (reemplaza Puntaje Total) -->
                <div class="card p-6 text-center">
                    <h2 class="text-sm font-bold text-gray-500 uppercase mb-2">Puntaje Ponderado (0–100%)</h2>
                    <div id="totalScoreDisplay" class="text-6xl font-black text-gray-800">0%</div>
                    <div id="statusBadge" class="mt-4 inline-block status-pill bg-gray-200 text-gray-600">Calculando...</div>
                    <div id="noEnciendeBadge" class="mt-3 inline-block status-pill bg-red-700 text-white hidden"></div>
                </div>

                <!-- Desglose de Ponderaciones -->
                <div class="card p-6">
                    <h2 class="text-sm font-bold text-gray-500 uppercase mb-4 text-center">Desglose Ponderaciones</h2>
                    <div class="grid grid-cols-3 gap-4">
                        <div id="antiguedadSide" class="p-2 rounded border bg-gray-50 flex flex-col items-center">
                            <div class="text-xs text-gray-700 uppercase font-extrabold text-center">Antigüedad (50%)</div>
                            <div id="antiguedadValue" class="text-lg font-extrabold text-gray-800 mt-2 text-center">0</div>
                            <div class="w-full bg-gray-200 rounded h-3 mt-3">
                                <div id="antiguedadBar" class="h-3 rounded bg-green-500" style="width:0%"></div>
                            </div>
                        </div>
                        <div id="estadoSide" class="p-2 rounded border bg-gray-50 flex flex-col items-center">
                            <div class="text-xs text-gray-700 uppercase font-extrabold text-center">Estado Físico (35%)</div>
                            <div id="estadoValue" class="text-lg font-extrabold text-gray-800 mt-2 text-center">0</div>
                            <div class="w-full bg-gray-200 rounded h-3 mt-3">
                                <div id="estadoBar" class="h-3 rounded bg-green-500" style="width:0%"></div>
                            </div>
                        </div>
                        <div id="rendimientoSide" class="p-2 rounded border bg-gray-50 flex flex-col items-center">
                            <div class="text-xs text-gray-700 uppercase font-extrabold text-center">Rend. Interno (15%)</div>
                            <div id="rendimientoValue" class="text-lg font-extrabold text-gray-800 mt-2 text-center">0</div>
                            <div class="w-full bg-gray-200 rounded h-3 mt-3">
                                <div id="rendimientoBar" class="h-3 rounded bg-green-500" style="width:0%"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- (tarjeta de puntaje ponderado movida arriba) -->

                <!-- Upgrades / Messages -->
                <div class="card p-6">
                    <h2 class="text-sm font-bold text-gray-800 uppercase mb-4 flex items-center">
                        <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20"><path d="M11.3 1.046A1 1 0 0112 2v5h4a1 1 0 01.82 1.573l-7 10A1 1 0 018 18v-5H4a1 1 0 01-.82-1.573l7-10a1 1 0 011.12-.38z"></path></svg>
                        Recomendaciones TI
                    </h2>
                    <div id="upgradeContainer" class="space-y-3">
                        <!-- Upgrades will appear here -->
                        <p class="text-gray-400 text-sm italic">Sin alertas pendientes.</p>
                    </div>
                </div>

                <!-- Info Box -->
                <div class="bg-blue-50 border-l-4 border-blue-500 p-4 rounded">
                    <h3 class="text-blue-800 font-bold text-sm">Criterio de Perfil</h3>
                    <p id="perfilInfo" class="text-blue-700 text-xs mt-1 leading-relaxed">
                        Los usuarios Administrativos no requieren GPU dedicada obligatoria.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        function calculateScore() {
            const selects = document.querySelectorAll('#tablaEvaluacion select');
            const upgradeContainer = document.getElementById('upgradeContainer');
            const totalDisplay = document.getElementById('totalScoreDisplay');
            const statusBadge = document.getElementById('statusBadge');
            const perfil = document.getElementById('perfilUsuario').value;
            const perfilInfo = document.getElementById('perfilInfo');
            
            let total = 0;
            let messages = [];
            let noReasignable = false;

            // Sumar puntos
            selects.forEach(sel => {
                const val = parseInt(sel.value);
                total += val;
                // Actualizar visualmente el puntaje por fila
                sel.closest('tr').querySelector('.score-val').innerText = val;
            });

            // Calcular máximo posible dinámicamente (para normalizar a 0-100)
            let maxPossible = 0;
            selects.forEach(sel => {
                const opts = Array.from(sel.options).map(o => parseInt(o.value) || 0);
                if (opts.length) maxPossible += Math.max(...opts);
            });
            const displayTotal = maxPossible > 0 ? Math.round((total / maxPossible) * 100) : 0;

            // Guardar total crudo de Antigüedad y calcular su ponderación al 50% (sin alterar los puntos seleccionados)
            const antiguedadSelSide = document.querySelector('select[data-key="antiguedad"]');
            const antiguedadRaw = antiguedadSelSide ? (parseInt(antiguedadSelSide.value) || 0) : 0;
            const antiguedadMax = antiguedadSelSide ? Math.max(...Array.from(antiguedadSelSide.options).map(o => parseInt(o.value) || 0)) : 0;
            const antiguedadPercent = antiguedadMax > 0 ? (antiguedadRaw / antiguedadMax) * 100 : 0;
            const antiguedadWeighted50 = Math.round((antiguedadPercent / 100) * 50); // contribución sobre 50
            const antiguedadValueEl = document.getElementById('antiguedadValue');
            const antiguedadBarEl = document.getElementById('antiguedadBar');
            if (antiguedadValueEl) antiguedadValueEl.innerText = antiguedadRaw;
            if (antiguedadBarEl) {
                const w = Math.round(antiguedadPercent);
                antiguedadBarEl.style.width = w + '%';
                antiguedadBarEl.className = 'h-3 rounded ' + (w >= 80 ? 'bg-green-500' : (w >= 60 ? 'bg-yellow-400' : 'bg-red-500'));
            }

            // Estado Físico (35%) - calcular crudo y ponderación
            const estadoKeys = ['carcasa','teclado','pantalla','bateria','usb','carga','hdmi','red','audio','camara'];
            let estadoRaw = 0, estadoMax = 0;
            estadoKeys.forEach(k => {
                const s = document.querySelector(`select[data-key="${k}"]`);
                if (s) {
                    estadoRaw += parseInt(s.value) || 0;
                    estadoMax += Math.max(...Array.from(s.options).map(o => parseInt(o.value) || 0));
                }
            });
            const estadoPercent = estadoMax > 0 ? (estadoRaw / estadoMax) * 100 : 0;
            const estadoWeighted35 = Math.round((estadoPercent / 100) * 35);
            const estadoValueEl = document.getElementById('estadoValue');
            const estadoBarEl = document.getElementById('estadoBar');
            if (estadoValueEl) estadoValueEl.innerText = estadoRaw;
            if (estadoBarEl) {
                const w = Math.round(estadoPercent);
                estadoBarEl.style.width = w + '%';
                estadoBarEl.className = 'h-3 rounded ' + (w >= 80 ? 'bg-green-500' : (w >= 60 ? 'bg-yellow-400' : 'bg-red-500'));
            }

            // Rendimiento Interno (15%) - calcular crudo y ponderación
            const rendimientoKeys = ['enciende','ram','disco','video'];
            let rendRaw = 0, rendMax = 0;
            rendimientoKeys.forEach(k => {
                const s = document.querySelector(`select[data-key="${k}"]`);
                if (s) {
                    rendRaw += parseInt(s.value) || 0;
                    rendMax += Math.max(...Array.from(s.options).map(o => parseInt(o.value) || 0));
                }
            });
            const rendPercent = rendMax > 0 ? (rendRaw / rendMax) * 100 : 0;
            const rendWeighted15 = Math.round((rendPercent / 100) * 15);
            const rendimientoValueEl = document.getElementById('rendimientoValue');
            const rendimientoBarEl = document.getElementById('rendimientoBar');
            if (rendimientoValueEl) rendimientoValueEl.innerText = rendRaw;
            if (rendimientoBarEl) {
                const w = Math.round(rendPercent);
                rendimientoBarEl.style.width = w + '%';
                rendimientoBarEl.className = 'h-3 rounded ' + (w >= 80 ? 'bg-green-500' : (w >= 60 ? 'bg-yellow-400' : 'bg-red-500'));
            }

            // Calcular puntaje ponderado total (max 100)
            const weightedTotal = (antiguedadWeighted50 || 0) + (estadoWeighted35 || 0) + (rendWeighted15 || 0);

            // LÓGICA DE UPGRADES Y REGLAS DE NEGOCIO
            
            // 1. Regla Disco Duro
            const discoVal = document.getElementById('discoSelect').value;
            // Si es HDD mecánico (valor '1'), recomendar cambio a SSD
            if (discoVal === "1") {
                messages.push({type: 'warning', text: 'Disco Duro: Evaluar antigüedad y estado físico del equipo para cambiar a Disco SSD.'});
            } else if (discoVal == "6") {
                if (perfil === 'CAD_BIM') {
                    messages.push({type: 'error', text: 'Disco Duro: Insuficiente para CAD/BIM, se requiere aumentar.'});
                } else {
                    messages.push({type: 'warning', text: 'Disco Duro: Se requiere mantener o aumentar disco según categoría del equipo.'});
                }
            }

            // Nueva regla Estado Batería: mensajes por rango y recomendaciones
            const bateriaSel = document.querySelector('select[data-key="bateria"]');
            const bateriaVal = bateriaSel ? bateriaSel.value : null;
            if (bateriaVal === "10") {
                messages.push({type: 'info', text: 'Batería excelente, poco uso.'});
            } else if (bateriaVal === "6") {
                messages.push({type: 'info', text: 'Batería buena, degradación leve.'});
            } else if (bateriaVal === "3") {
                messages.push({type: 'warning', text: 'Batería Aceptable / Gastada.'});
            } else if (bateriaVal === "1") {
                messages.push({type: 'warning', text: 'Batería degradada, es recomendable cambiar según antigüedad del equipo.'});
            } else if (bateriaVal === "0") {
                messages.push({type: 'critical', text: 'Batería muy gastada, es recomendable cambiar según antigüedad del equipo.'});
            }

            // 1.b Regla Puertos USB: algunos con fallas
            const usbSel = document.querySelector('select[data-key="usb"]');
            const usbVal = usbSel ? usbSel.value : null;
            if (usbVal === "1") {
                messages.push({type: 'warning', text: 'USB: Evaluar antigüedad y estado físico del equipo para salvar puerto USB.'});
            }

            // 1.h Regla Estado Físico: Carcasa dañada
            const carcSel = document.querySelector('select[data-key="carcasa"]');
            const carcVal = carcSel ? carcSel.value : null;
            if (parseInt(carcVal) <= 1) {
                messages.push({type: 'warning', text: 'Carcasa: Evaluar equipo según su antigüedad para Préstamo o Reciclaje.'});
            }

            // 1.i Regla Estado Físico: Teclado dañado
            const teclaSel = document.querySelector('select[data-key="teclado"]');
            const teclaVal = teclaSel ? teclaSel.value : null;
            if (parseInt(teclaVal) <= 1) {
                messages.push({type: 'warning', text: 'Teclado: Evaluar equipo según su antigüedad para Préstamo o Reciclaje.'});
            }

            // 1.j Regla Estado Físico: Pantalla dañada
            const pantSel = document.querySelector('select[data-key="pantalla"]');
            const pantVal = pantSel ? pantSel.value : null;
            if (parseInt(pantVal) <= 1) {
                messages.push({type: 'warning', text: 'Pantalla: Evaluar equipo según su antigüedad para Préstamo o Reciclaje.'});
            }

            // 1.c Regla Puerto de carga delicado
            const cargaSel = document.querySelector('select[data-key="carga"]');
            const cargaVal = cargaSel ? cargaSel.value : null;
            if (cargaVal === "6") {
                messages.push({type: 'warning', text: 'Puerto Carga: Puerto principal delicado, revisar para mantención según antigüedad, o mandar a Reciclaje / Préstamo.'});
            }
            // Si el puerto de carga está en mal estado
            if (cargaVal === "1") {
                messages.push({type: 'warning', text: 'Puerto Carga: Evaluar antigüedad del equipo para salvar puerto o mandar a Reciclaje / Préstamo.'});
            }

            // 1.d Regla Puerto Red: No funciona
            const redSel = document.querySelector('select[data-key="red"]');
            const redVal = redSel ? redSel.value : null;
            if (redVal === "1") {
                messages.push({type: 'warning', text: 'Puerto Red: Evaluar antigüedad y estado físico del equipo para salvar Puerto de Red, o mandar a Reciclaje / Préstamo.'});
            }

            // 1.e Regla Puerto HDMI: No funciona
            const hdmiSel = document.querySelector('select[data-key="hdmi"]');
            const hdmiVal = hdmiSel ? hdmiSel.value : null;
            if (hdmiVal === "1") {
                messages.push({type: 'warning', text: 'Puerto HDMI: Evaluar antigüedad y estado físico del equipo para salvar puerto HDMI, o mandar a Reciclaje / Préstamo.'});
            }

            // 1.f Regla Audio: No funciona
            const audioSel = document.querySelector('select[data-key="audio"]');
            const audioVal = audioSel ? audioSel.value : null;
            if (audioVal === "1") {
                messages.push({type: 'warning', text: 'Audio: Evaluar antigüedad y estado físico del equipo para salvar el estado del audio, o mandar a Reciclaje / Préstamo.'});
            }

            // 1.g Regla Cámara: No funciona
            const camSel = document.querySelector('select[data-key="camara"]');
            const camVal = camSel ? camSel.value : null;
            if (camVal === "1") {
                messages.push({type: 'warning', text: 'Cámara: Evaluar antigüedad y estado físico del equipo para salvar la cámara, o mandar a Reciclaje / Préstamo.'});
            }

            // Regla ¿Enciende?: No enciende -> mandar a Reciclaje
            const enciendeSel = document.querySelector('select[data-key="enciende"]');
            const enciendeVal = enciendeSel ? enciendeSel.value : null;
            if (enciendeVal === "0") {
                messages.push({type: 'error', text: '¿Enciende?: No enciende, mandar equipo a Reciclaje.'});
                // Forzar no reasignable si no enciende
                noReasignable = true;
            }

            // Mostrar/ocultar badge rojo destacado bajo Puntaje Total si no enciende
            const noEnciendeBadge = document.getElementById('noEnciendeBadge');
            if (noEnciendeBadge) {
                if (enciendeVal === "0") {
                    noEnciendeBadge.innerText = 'EQUIPO NO ENCIENDE';
                    noEnciendeBadge.classList.remove('hidden');
                } else {
                    noEnciendeBadge.innerText = '';
                    noEnciendeBadge.classList.add('hidden');
                }
            }

            // 2. Regla RAM según Perfil
            const ramVal = document.getElementById('ramSelect').value; // 10:32, 6:16, 4:8, 2:4
            if (perfil === 'ADMIN' && parseInt(ramVal) < 6) {
                messages.push({type: 'info', text: 'Upgrade RAM: Subir ≥ a 16GB para mejor desempeño.'});
            }
            if (perfil === 'CAD_BIM' && parseInt(ramVal) < 6) {
                messages.push({type: 'critical', text: 'Memoria RAM: Upgrade de RAM obligatorio para CAD/BIM a ≥ 16GB.'});
            }
            // Si no tiene RAM o hay falla, sugerir evaluar según antigüedad/estado
            if (ramVal === "0") {
                messages.push({type: 'warning', text: 'Evaluar antigüedad y estado físico del equipo para colocar RAM o mandar equipo a Reciclaje / Préstamo.'});
            }

            // 3. Regla GPU para CAD/BIM
            const gpuVal = document.getElementById('gpuSelect').value;
            // Mensaje adicional para GPU integrada (si existiera)
            if (gpuVal === "2") {
                messages.push({type: 'info', text: 'GPU limitada.'});
            }
            if (perfil === 'CAD_BIM') {
                perfilInfo.innerText = "Perfil CAD/BIM requiere GPU dedicada >= 4GB obligatoria para calificar.";
                if (parseInt(gpuVal) < 6) { // Menos de 4GB
                    messages.push({type: 'error', text: 'GPU: Insuficiente para CAD/BIM.'});
                }
            } else {
                perfilInfo.innerText = "Los usuarios Administrativos no requieren GPU dedicada obligatoria.";
            }

            // 4. Regla Antigüedad - equipos no reasignables
            const antiguedadSel = document.querySelector('select[data-key="antiguedad"]');
            const antiguedadVal = antiguedadSel ? antiguedadSel.value : null;
            if (antiguedadSel) {
                if (antiguedadSel.selectedIndex === 3) { // 7 - 8 años
                    messages.push({
                        type: 'error',
                        text: 'EQUIPO: Antigüedad 7–8 años — Fin de vida útil operativa. No apto para reasignación. Priorizar reciclaje o préstamo. '
                    });
                    noReasignable = true;
                }
                if (antiguedadSel.selectedIndex === 4) { // 9 - 10 años
                    messages.push({
                        type: 'error',
                        text: 'EQUIPO: Antigüedad 9–10 años — Fin de vida útil operativa. No apto para reasignación. Priorizar reciclaje o préstamo.'
                    });
                    noReasignable = true;
                }
            }

            // Renderizar mensajes
            upgradeContainer.innerHTML = '';
            if (messages.length === 0) {
                upgradeContainer.innerHTML = '<p class="text-green-500 text-sm font-medium">✓ Equipo cumple requerimientos base.</p>';
            } else {
                messages.forEach(msg => {
                    let colorClass = 'bg-yellow-100 text-yellow-800 border-yellow-200';
                    if (msg.type === 'critical' || msg.type === 'error') colorClass = 'bg-red-100 text-red-800 border-red-200';
                    if (msg.type === 'info') colorClass = 'bg-blue-100 text-blue-800 border-blue-200';
                    
                    const div = document.createElement('div');
                    div.className = `p-3 rounded border text-xs font-bold ${colorClass}`;
                    div.innerText = msg.text;
                    upgradeContainer.appendChild(div);
                });
            }

            // Estado Final (mostrar total ponderado 0-100)
            totalDisplay.innerText = `${weightedTotal}%`;
            // Rangos:
            // - >= 60% => CANDIDATO A REASIGNACIÓN
            // - 40% - 59% => CANDIDATO A PRÉSTAMO
            // - <= 39% => CANDIDATO A RECICLAJE
            if (noReasignable) {
                statusBadge.innerText = "CANDIDATO A RECICLAJE";
                statusBadge.className = "mt-4 inline-block status-pill bg-red-700 text-white";
                totalDisplay.className = "text-6xl font-black text-red-600";
            } else if (weightedTotal >= 60) {
                statusBadge.innerText = "CANDIDATO A REASIGNACIÓN";
                statusBadge.className = "mt-4 inline-block status-pill bg-green-600 text-white";
                totalDisplay.className = "text-6xl font-black text-green-600";
            } else if (weightedTotal >= 40) {
                statusBadge.innerText = "CANDIDATO A PRÉSTAMO";
                statusBadge.className = "mt-4 inline-block status-pill bg-yellow-500 text-white";
                totalDisplay.className = "text-6xl font-black text-yellow-600";
            } else {
                statusBadge.innerText = "CANDIDATO A RECICLAJE";
                statusBadge.className = "mt-4 inline-block status-pill bg-red-700 text-white";
                totalDisplay.className = "text-6xl font-black text-red-600";
            }
        }

        // Ejecutar al cargar
        window.onload = calculateScore;
    </script>
</body>
</html>